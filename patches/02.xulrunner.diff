diff -urN UXP-RELBASE_20210719/xulrunner/app/moz.build xulrunner-source/xulrunner/app/moz.build
--- UXP-RELBASE_20210719/xulrunner/app/moz.build	2021-07-16 01:13:31.000000000 +0200
+++ xulrunner-source/xulrunner/app/moz.build	2021-07-23 16:01:31.131132072 +0200
@@ -3,7 +3,10 @@
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
-GeckoProgram('xulrunner')
+if CONFIG['MOZ_DEBUG']:
+    GeckoProgram('xulrunner')
+else:
+    GeckoProgram('xulrunner', mozglue='library')
 
 SOURCES += [
     'nsXULRunnerApp.cpp',
diff -urN UXP-RELBASE_20210719/xulrunner/build.mk xulrunner-source/xulrunner/build.mk
--- UXP-RELBASE_20210719/xulrunner/build.mk	1970-01-01 01:00:00.000000000 +0100
+++ xulrunner-source/xulrunner/build.mk	2021-07-23 16:01:31.147132383 +0200
@@ -0,0 +1,36 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+installer:
+	@echo 'XULRunner doesn't have an installer yet.'
+
+package:
+	@$(MAKE) -C xulrunner/installer
+
+install:
+	@$(MAKE) -C xulrunner/installer install
+
+sdk:
+	@$(MAKE) -C xulrunner/installer make-sdk
+
+distclean::
+	@$(MAKE) -C xulrunner/installer distclean
+
+source-package::
+	@$(MAKE) -C xulrunner/installer source-package
+
+upload::
+	@$(MAKE) -C xulrunner/installer upload
+
+source-upload::
+	@$(MAKE) -C xulrunner/installer source-upload
+
+hg-bundle::
+	@$(MAKE) -C xulrunner/installer hg-bundle
+
+ifeq ($(OS_TARGET),Linux)
+deb: package
+	@$(MAKE) -C xulrunner/installer deb
+endif
+
diff -urN UXP-RELBASE_20210719/xulrunner/Makefile.in xulrunner-source/xulrunner/Makefile.in
--- UXP-RELBASE_20210719/xulrunner/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ xulrunner-source/xulrunner/Makefile.in	2021-07-23 16:01:31.147132383 +0200
@@ -0,0 +1,14 @@
+# This Source Code Form is subject to the terms of the Mozilla Public
+# License, v. 2.0. If a copy of the MPL was not distributed with this
+# file, You can obtain one at http://mozilla.org/MPL/2.0/.
+
+include $(topsrcdir)/config/rules.mk
+
+ifdef MAKENSISU
+
+# For Windows build the uninstaller during the application build since the
+# uninstaller is included with the application for mar file generation.
+libs::
+	$(MAKE) -C installer/windows uninstaller
+endif
+
diff -urN UXP-RELBASE_20210719/xulrunner/moz.build xulrunner-source/xulrunner/moz.build
--- UXP-RELBASE_20210719/xulrunner/moz.build	2021-07-16 01:13:31.000000000 +0200
+++ xulrunner-source/xulrunner/moz.build	2021-07-23 16:01:31.147132383 +0200
@@ -7,4 +7,12 @@
 
 DIRS += [
     'app',
+    'stub'
 ]
+
+if CONFIG['MAKENSISU']:
+    DIRS += ['installer/windows']
+
+if CONFIG['OS_ARCH'] == 'WINNT':
+    DIRS += ['tools/redit']
+
diff -urN UXP-RELBASE_20210719/xulrunner/stub/moz.build xulrunner-source/xulrunner/stub/moz.build
--- UXP-RELBASE_20210719/xulrunner/stub/moz.build	2021-07-16 01:13:31.000000000 +0200
+++ xulrunner-source/xulrunner/stub/moz.build	2021-07-23 16:01:31.147132383 +0200
@@ -3,14 +3,12 @@
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
-# The value of XULRUNNER_STUB_NAME is generated by configure to allow XULRunner
-# apps to override it using the --with-xulrunner-stub-name=<appname> argument.
-# If this configure argument is not present then the default name is
-# 'xulrunner-stub'.
-
-# We don't want to create a dependency on mozglue.
 # Statically link against the RTL on windows
-GeckoProgram(CONFIG['XULRUNNER_STUB_NAME'], mozglue=None, msvcrt='static')
+
+if CONFIG['MOZ_DEBUG']:
+    GeckoProgram('xulrunner-stub', msvcrt='static')
+else:
+    GeckoProgram('xulrunner-stub', msvcrt='static', mozglue='library')
 
 SOURCES += [
     'nsXULStub.cpp',
